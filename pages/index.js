import Head from 'next/head';
import Layout from '../components/layout';
import { Typography } from '@mui/material';
import Box from '@mui/material/Box';
import Stack from '@mui/material/Stack';
import Button from '@mui/material/Button';
import { styled } from '@mui/material/styles';
import { useState } from 'react';
import Image from 'next/image';

export default function Home() {
  // input button component
  const Input = styled('input')({
    display: 'none',
  });

  const [images, setImages] = useState([]);

  const toBase64 = (file) =>
    new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = (error) => reject(error);
    });


  function doSomethingWithFiles(fileList) {
    let file = null;

    for (let i = 0; i < fileList.length; i++) {
      if (fileList[i].type.match(/^image\//)) {
        file = fileList[i];
        break;
      }
    }

    if (file !== null) {
      const newImages = [...images];
      newImages.push(URL.createObjectURL(file));
      setImages(newImages);
      toBase64(file).then((result) => console.log(result));
    }
  }

  function test(image) {
    const files = image.target.files;

    doSomethingWithFiles(files);
  }



  return (
    <Layout>
      <Head>
        <title>Home</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Typography variant="h4">Home</Typography>
      <Typography component="div">
        Your company is <Box sx={{ fontWeight: "bold" }} display="inline"> Cap3</Box>
      </Typography>
      <Typography component="div">
        Number of employee in your company using this app is <Box sx={{ fontWeight: "bold" }} display="inline">10</Box>
      </Typography>
      <Stack
        direction={{ xs: 'column', sm: 'row' }}
        spacing={{ xs: 1, sm: 2, md: 4 }}
      >
        <Typography component="div">Happy: <Box sx={{ fontWeight: "bold" }} display="inline">7</Box> </Typography>
        <Typography component="div">Sad: <Box sx={{ fontWeight: "bold" }} display="inline">1</Box> </Typography>
        <Typography component="div">Angry: <Box sx={{ fontWeight: "bold" }} display="inline">1</Box> </Typography>
        <Typography component="div">Confused: <Box sx={{ fontWeight: "bold" }} display="inline">1</Box> </Typography>
      </Stack>


      {/* render uploaded image */}
      <div style={{ display: "flex", flexDirection: "row" }}>
        {images.map((image, index) => (
          <div key={index} style={{ width: "150px", paddingRight: "12px" }}>
            <Image src={image} alt="uploaded picture" width="256" height="256" />
          </div>
        ))}
      </div>

      {/* upload button image */}
      <label htmlFor="contained-button-file">
        <Input accept="image/*" id="contained-button-file" multiple type="file" onChange={test} />
        <Button variant="contained" component="span">
          Upload
        </Button>
      </label>
    </Layout>
  )
}